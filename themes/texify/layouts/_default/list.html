
{{ define "head" }}
{{ $options := dict "transpiler" "dartsass" "targetPath" "css/list.css" }}
{{ with resources.Get "sass/layouts/list.scss" | toCSS $options | postCSS | minify | fingerprint }}
  <link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous">
{{ end }}
{{ end }}

{{ define "main" }}
<main id="main" class="archive">
  {{ if .Site.Params.enableDuckDuckGoSearchBox }}
  <div id="searchbox">
    <form method="get" id="ddgSearch" target="_blank" action="https://duckduckgo.com/">
        <input type="hidden" name="sites" value="{{ .Site.BaseURL }}"/>
        <input type="hidden" name="kf" value="-1"> <!-- no favicons -->
        <input type="hidden" name="kh" value="1"> <!-- https -->
        <input type="hidden" name="kae" value="d" > <!-- dark theme -->
        <input type="hidden" name="k1" value="-1" > <!-- no ads -->
        <input type="text" name="q" placeholder="Search…" aria-label="Search michaelneuper.com on DuckDuckGo"/>
        <button type="submit">
            <svg aria-hidden="true" height="1rem" viewBox="0 0 16 16" version="1.1" width="1rem" data-view-component="true" class="octicon octicon-search Button-visual">
            <path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7Z"></path>
            </svg>
          </button>
    </form>
  </div>
  {{ end }}  

  {{/* All categories + tags in the blog */}}
  {{ if or .Site.Taxonomies.categories .Site.Taxonomies.tags }}
    <div class="post-taxonomy-overview">
      {{ with .Site.Taxonomies.categories }}
      <div class="post-taxonomy-line">
        {{ range $name, $_ := . }}
          <a class="link tag" href='{{ "categories" | relURL }}/{{ $name | urlize }}/'>@{{ $name }}</a>
        {{ end }}
      </div>
      {{ end }}

      {{ with .Site.Taxonomies.tags }}
      <div class="post-taxonomy-line">
        {{ range $name, $_ := . }}
          <a class="link tag" href='{{ "tags" | relURL }}/{{ $name | urlize }}/'>#{{ $name }}</a>
        {{ end }}
      </div>
      {{ end }}
    </div>
  {{ end }}

  {{/* Collect posts and paginate them */}}
  {{ $pages := where .Site.RegularPages "Type" "posts" }}
  {{ $pageSize := .Site.Params.postsPerPage | default 10 | int }}
  {{ $paginator := .Paginate $pages $pageSize }}

  {{/* Debug line: show total pages as an HTML comment */}}
  {{ printf "<!-- paginator.TotalPages = %d -->" $paginator.TotalPages | safeHTML }}

  {{/* Group ONLY this page's posts by month */}}
  {{ range $paginator.Pages.GroupByDate "2006-01" }}
  <div class="post-group">
    <h3>{{ dateFormat "January 2006" (printf "%s-01" .Key) }}</h3>
    <ul>
      {{ range .Pages }}
      <li>
        <a class="link" href="{{ .RelPermalink }}">{{ .Title }}</a>
        <time>{{ .PublishDate.Format .Site.Params.dateFormat }}</time>
      </li>
      {{ end }}
    </ul>
  </div>
  {{ end }}

  <nav class="yh-pagination" aria-label="Pagination">
    <!-- Prev -->
    <a
      class="yh-page-arrow yh-page-arrow-prev{{ if not $paginator.HasPrev }} yh-page-arrow-disabled{{ end }}"
      {{ if $paginator.HasPrev }}href="{{ $paginator.Prev.URL }}"{{ end }}>
      ‹
    </a>

    <!-- Page numbers with smart ... -->
    <div class="yh-page-list">
      {{ $current := $paginator.PageNumber }}
      {{ $total := $paginator.TotalPages }}
      {{ $s := newScratch }}
      {{ $s.Set "lastShown" 0 }}

      {{ range $paginator.Pagers }}
        {{ $n := .PageNumber }}

        {{ if or (or (eq $n 1) (eq $n $total))
                (and (ge $n (sub $current 1)) (le $n (add $current 1))) }}

          {{ $last := $s.Get "lastShown" }}
          {{ if and (gt $n 1) (gt (sub $n $last) 1) }}
            <span class="yh-page-ellipsis" title="More pages">⋯</span>
          {{ end }}

          <a
            href="{{ .URL }}"
            class="yh-page-link{{ if eq $n $current }} yh-page-link-current{{ end }}">
            {{ $n }}
          </a>

          {{ $s.Set "lastShown" $n }}
        {{ end }}
      {{ end }}
    </div>

    <!-- Next -->
    <a
      class="yh-page-arrow yh-page-arrow-next{{ if not $paginator.HasNext }} yh-page-arrow-disabled{{ end }}"
      {{ if $paginator.HasNext }}href="{{ $paginator.Next.URL }}"{{ end }}>
      ›
    </a>
  </nav>

</main>
{{ end }}
